# task

### Команды для настройки докера

1) Поднятие контейнера с PostgreSQL

```docker run --name postgres -e POSTGRES_USER=hipstercard-user -e POSTGRES_PASSWORD=hipsterCardPassword -e POSTGRES_DB=hipstercard-db -d -p 5432:5432 postgres```


2) Поднятие сети

```docker network create -d bridge  hipstercard-network```



## Задание

Акционерный банк решил идти в ногу со временем и разработать новый продукт лояльности «Хипстокарту» – карту с начислением бонусов от покупок (кэшбэк). Для учета карт и формирования бонусных начислений банку требуется разработать новую систему и встроить ее в свою инфраструктуру.
1.	Все выданные клиентам «хипстокарты» привязываются к счетам банка по номеру счета. Также каждая карта связывается с уникальным внутренним идентификатором клиента.
2.	Система получает от процессингового центра банка информацию о совершаемых транзакциях. Каждая транзакция содержит информацию о номере счета, сумме счета после применения транзакции, сумме транзакции, коде организации со стороны банка-эмитента и категории операции, определенной правилами банка. Если указанный в транзакции счет привязан к «хипстокарте», то при выполнении условий начисления бонусов система в свою очередь формирует новую транзакцию зачисления средств и передает ее в процессинговый центр.
3.	Карты выпускаются в двух вариантах: обычная и золотая.
4.	Условия начисления бонусов:
* Сумма счета до применения транзакции должна превышать 30 тыс. ₽ для обычной карты и 50 тыс. ₽ для золотой.
* Клиент совершил минимум одну операцию по одной из своих «хипстокарт» в течение 30 последних дней.
5.	Сумма бонуса формируется в процентном отношении к сумме транзакции и зависит от категории покупки и организации. Базовый процент кэшбэка для обычной карты составляет 1%, для золотой – 1,5%. Процент возврата может быть увеличен:
* для отдельных категорий покупок, зарегистрированных в системе (пример категорий: «топливные заправки», «рестораны и кафе», «путешествия»);
* для отдельных организаций, зарегистрированных в системе.
Для применения дополнительных ставок коды категорий покупок и организаций должны совпадать с формируемыми процессинговой системой (и указываемых в транзакциях). Процент возврата не может быть ниже базового для каждого типа карты: если для одной из организаций зарегистрирован процент возврата 1,3%, то при оплате услуг этой организации обычной «хипстокартой» кэшбэк составит 1,3%, золотой – 1,5%.
6.	Аудит изменений: для данных о картах, категориях покупок и организациях должны фиксироваться: автор, последний редактор (источник изменений), дата создания и последнего изменения. Должен быть предусмотрен журнал изменений по каждому типу данных.
7.	Данные о категориях покупках и организациях, внесенные в систему требуют подтверждения, изменения могут быть приняты или отклонены пользователем с соответствующей ролью. При наличии неподтвержденных изменений дополнительные бонусы не начисляются.
8.	Для интеграции в банковскую инфраструктуру должен быть разработан сервис, позволяющий для указанного на входе набора транзакций сформировать список транзакций начисления кэшбэка. Способ интеграции и формат взаимодействия определяет разработчик системы.
9. Реализация по возможности должна быть представлена в виде отдельных сервисов, разделенных по сабдоменам и с функциональностью в соответствии с ограниченными контекстами.

## Уточнение требований

По результатам обсуждения с заказчиком, внесены следующие уточнения к первоначальным требованиям:

1.	Банк не собирается ограничиваться двумя типами «хипстокарт»: обычной и золотой и планирует выпускать новые типы с разными ставками возврата и требованиями к минимальным суммам счета. Сотрудники банка хотят видеть в системе возможность регистрировать новые типы карт самостоятельно.
2.	Для организаций планируется ввести гибкие ставки возврата, зависящие от суммы транзакции. Например:
*	«Даблби» > 300 ₽ – 5,0%
*	«Даблби» > 1000 ₽ – 5,5%
*	«Даблби» > 3000 ₽ – 6,0%